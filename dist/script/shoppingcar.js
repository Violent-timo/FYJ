"use strict";jQuery("#header").load("./connhead.html"),function(a){var i,e,d;localStorage.getItem(a.cookie("username")+"goodsid")&&(i=a.cookie("username"),e=localStorage.getItem(i+"goodsid"),d=localStorage.getItem(i+"goodsnum").split(","),e&&d&&a.post("../php/shoppingcar.php",{id:e},function(i){for(var e=JSON.parse(i),t=0;t<e.length;t++){var n=a(".things:hidden").clone(!0,!0);n.find(".thing-img img").attr("src",e[t].goods_img),n.find(".name").html(e[t].goods_name),n.find(".thing-price span").html(e[t].goods_price),n.find(".money span").html(e[t].goods_price).attr({unitprice:e[t].goods_price}),n.find(".numtog input").val(d[t]).attr({id:e[t].id}),n.find(".numtog .reduce").attr({id:e[t].id}),n.find(".numtog .add").attr({id:e[t].id}),n.find(".removeself").attr({id:e[t].id}),n.css("display","block"),a(".buy-list").append(n)}var s=a(".things:visible").find(".numtog input"),o=a(".things:visible").find(".numtog .reduce"),l=a(".things:visible").find(".money span");a.each(s,function(i,e){l.eq(i).html((s.eq(i).val()*l.eq(i).attr("unitprice")).toFixed(2)),1<e.value&&a(o[i]).removeClass("ban")})}))}(jQuery),function(a){var e=a(".buy-wrap"),t=a(".checkall"),n=a(".choose-kinds span"),s=a(".choose-amount span"),o=a(".amount-total strong");function l(){var i=a(".things:visible").find(".numtog input"),t=a(".things:visible").find('input[type="checkbox"]'),n=0;return a.each(i,function(i,e){t.eq(i).prop("checked")&&(n+=Number(e.value))}),n}function d(){var i=a(".things:visible").find(".money span"),t=a(".things:visible").find('input[type="checkbox"]'),n=0;return a.each(i,function(i,e){t.eq(i).prop("checked")&&(n+=Number(e.innerText))}),n.toFixed(2)}function h(i,e,t){var n=i.attr("id"),s=localStorage.getItem(a.cookie("username")+"goodsid").split(","),o=localStorage.getItem(a.cookie("username")+"goodsnum").split(","),l=s.indexOf(n);"plus"==e&&(o[l]=t),"dele"!=e&&"deleall"!=e||(s.splice(l,1),o.splice(l,1)),"+"==e&&o[l]++,"-"==e&&o[l]--,localStorage.setItem(a.cookie("username")+"goodsid",s),localStorage.setItem(a.cookie("username")+"goodsnum",o)}t.on("click",function(){var i=a(".things:visible").find('input[type="checkbox"]').length;e.find("input:checkbox").not(a(this)).prop("checked",a(this).prop("checked")),a(this).prop("checked")?n.html(i):n.html("0"),s.html(l()),o.html(d())}),a(".delete").on("click",function(){var t=a(".things:visible").find("input:checked");confirm("是否删除")&&a.each(t,function(i,e){a(e).parent().remove(),h(t.eq(i),"deleall")}),n.html(a(".things:visible").find("input:checked").length),s.html(l()),o.html(d())}),e.on("click",".things input:checkbox",function(){var i=a(".things:visible").find('input[type="checkbox"]').length,e=a(".things:visible").find("input:checked");e.length==i?t.prop("checked",!0):t.prop("checked",!1),n.html(e.length),s.html(l()),o.html(d())}),e.on("click",".things .removeself",function(){confirm("是否删除")&&(h(a(this),"dele"),a(this).parent().parent().remove()),n.html(a(".things:visible").find("input:checked").length),s.html(l()),o.html(d())}),e.on("click",".numtog .reduce",function(){var i=a(".things:visible").find(".numtog input"),e=a(".things:visible").find(".numtog .reduce").index(a(this)),t=a(".things:visible").find(".money span");1<Number(i.eq(e).val())?(h(a(this),"-"),i.eq(e).val(i.eq(e).val()-1),Number(i.eq(e).val())<=1&&a(this).addClass("ban"),a(".things:visible .numtog .add").eq(e).removeClass("ban")):(a(this).addClass("ban"),i.eq(e).val("1")),t.eq(e).text((i.eq(e).val()*t.eq(e).attr("unitprice")).toFixed(2)),s.html(l()),o.html(d())}),e.on("click",".numtog .add",function(){var i=a(".things:visible").find(".numtog input"),e=a(".things:visible").find(".numtog .add").index(a(this)),t=a(".things:visible").find(".money span"),n=a(".things:visible").find(".numtog input").eq(e);n.val()<999?(h(a(this),"+"),i.eq(e).val(Number(i.eq(e).val())+1),999<=n.val()&&a(".things:visible .add").eq(e).addClass("ban")):(n.val(999),a(".things:visible .add").eq(e).addClass("ban")),1<Number(i.eq(e).val())&&a(this).parent().find(".reduce").removeClass("ban"),t.eq(e).text((i.eq(e).val()*t.eq(e).attr("unitprice")).toFixed(2)),s.html(l()),o.html(d())}),e.on("input",".numtog input",function(){/^\d+$/.test(a(this).val())||a(this).val("")}),e.on("blur",".numtog input",function(){var i=a(".things:visible").find(".money span"),e=a(".things:visible .numtog input").index(a(this));a(this).val()<=1?(a(this).val(1),a(".things:visible .reduce").eq(e).addClass("ban")):a(".things:visible .reduce").eq(e).removeClass("ban"),999<=a(this).val()&&(a(this).val(999),a(".things:visible .add").eq(e).addClass("ban")),i.eq(e).text((a(this).val()*i.eq(e).attr("unitprice")).toFixed(2)),h(a(this),"plus",a(this).val()),s.html(l()),o.html(d())})}(jQuery);