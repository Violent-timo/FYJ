"use strict";jQuery("#header").load("./connhead.html"),function(a){var e,i,d;localStorage.getItem(a.cookie("username")+"goodsid")&&(e=a.cookie("username"),i=localStorage.getItem(e+"goodsid"),d=localStorage.getItem(e+"goodsnum").split(","),i&&d&&a.post("../php/shoppingcar.php",{id:i},function(e){for(var i=JSON.parse(e),t=0;t<i.length;t++){var n=a(".things:hidden").clone(!0,!0);n.find(".thing-img img").attr("src",i[t].goods_img),n.find(".name").html(i[t].goods_name),n.find(".thing-price span").html(i[t].goods_price),n.find(".money span").html(i[t].goods_price).attr({unitprice:i[t].goods_price}),n.find(".numtog input").val(d[t]).attr({id:i[t].id}),n.find(".numtog .reduce").attr({id:i[t].id}),n.find(".numtog .add").attr({id:i[t].id}),n.find(".removeself").attr({id:i[t].id}),n.css("display","block"),a(".buy-list").append(n)}var o=a(".things:visible").find(".numtog input"),s=a(".things:visible").find(".numtog .reduce"),l=a(".things:visible").find(".money span");a.each(o,function(e,i){l.eq(e).html((o.eq(e).val()*l.eq(e).attr("unitprice")).toFixed(2)),1<i.value&&a(s[e]).removeClass("ban")})}))}(jQuery),function(a){var i=a(".buy-wrap"),t=a(".checkall"),n=a(".choose-kinds span"),o=a(".choose-amount span"),s=a(".amount-total strong");function l(){var e=a(".things:visible").find(".numtog input"),t=a(".things:visible").find('input[type="checkbox"]'),n=0;return a.each(e,function(e,i){t.eq(e).prop("checked")&&(n+=Number(i.value))}),n}function d(){var e=a(".things:visible").find(".money span"),t=a(".things:visible").find('input[type="checkbox"]'),n=0;return a.each(e,function(e,i){t.eq(e).prop("checked")&&(n+=Number(i.innerText))}),n.toFixed(2)}function c(e,i,t){var n=e.attr("id"),o=localStorage.getItem(a.cookie("username")+"goodsid").split(","),s=localStorage.getItem(a.cookie("username")+"goodsnum").split(","),l=o.indexOf(n);"plus"==i&&(s[l]=t),"dele"!=i&&"deleall"!=i||(o.splice(l,1),s.splice(l,1)),"+"==i&&s[l]++,"-"==i&&s[l]--,localStorage.setItem(a.cookie("username")+"goodsid",o),localStorage.setItem(a.cookie("username")+"goodsnum",s)}t.on("click",function(){var e=a(".things:visible").find('input[type="checkbox"]').length;i.find("input:checkbox").not(a(this)).prop("checked",a(this).prop("checked")),a(this).prop("checked")?n.html(e):n.html("0"),o.html(l()),s.html(d())}),a(".delete").on("click",function(){var t=a(".things:visible").find("input:checked");confirm("是否删除")&&a.each(t,function(e,i){a(i).parent().remove(),c(t.eq(e),"deleall")}),n.html(a(".things:visible").find("input:checked").length),o.html(l()),s.html(d())}),i.on("click",".things input:checkbox",function(){var e=a(".things:visible").find('input[type="checkbox"]').length,i=a(".things:visible").find("input:checked");i.length==e?t.prop("checked",!0):t.prop("checked",!1),n.html(i.length),o.html(l()),s.html(d())}),i.on("click",".things .removeself",function(){confirm("是否删除")&&(c(a(this),"dele"),a(this).parent().parent().remove()),n.html(a(".things:visible").find("input:checked").length),o.html(l()),s.html(d())}),i.on("click",".numtog .reduce",function(){var e=a(".things:visible").find(".numtog input"),i=a(".things:visible").find(".numtog .reduce").index(a(this)),t=a(".things:visible").find(".money span");1<Number(e.eq(i).val())?(c(a(this),"-"),e.eq(i).val(e.eq(i).val()-1),a(".things:visible .numtog .add").eq(i).removeClass("ban")):(a(this).addClass("ban"),e.eq(i).val("1")),t.eq(i).text((e.eq(i).val()*t.eq(i).attr("unitprice")).toFixed(2)),o.html(l()),s.html(d())}),i.on("click",".numtog .add",function(){var e=a(".things:visible").find(".numtog input"),i=a(".things:visible").find(".numtog .add").index(a(this)),t=a(".things:visible").find(".money span");c(a(this),"+"),e.eq(i).val(Number(e.eq(i).val())+1),1<Number(e.eq(i).val())&&a(this).parent().find(".reduce").removeClass("ban"),t.eq(i).text((e.eq(i).val()*t.eq(i).attr("unitprice")).toFixed(2)),o.html(l()),s.html(d())}),i.on("blur",".numtog input",function(){var e=a(".things:visible").find(".money span"),i=a(".things:visible .numtog input").index(a(this));a(this).val()<=1&&(a(this).val(1),a(".things:visible .reduce").eq(i).addClass("ban")),999<=a(this).val()&&(a(this).val(999),a(".things:visible .add").eq(i).addClass("ban")),e.eq(i).text((a(this).val()*e.eq(i).attr("unitprice")).toFixed(2)),c(a(this),"plus",a(this).val()),o.html(l()),s.html(d())})}(jQuery);