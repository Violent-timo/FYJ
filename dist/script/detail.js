"use strict";$("#head").load("./connhead.html"),$("#wrap").load("./conn.html"),function(){var o=$(".smallimg"),u=$(".smallimg img"),i=$(".smallshade"),p=$(".bigshade");o.hover(function(){i.css({display:"block",width:u.outerWidth()*p.outerWidth()/parseInt(p.css("background-size").split(" ")[0]),height:u.outerHeight()*p.outerHeight()/parseInt(p.css("background-size").split(" ")[1])}),p.css({display:"block"});var a=parseInt(p.css("background-size").split(" ")[0])/u.outerWidth();$(this).on("mousemove",function(t){var s=t.pageX-o.offset().left-i.outerWidth()/2,e=t.pageY-o.offset().top-i.outerHeight()/2;s<0?s=0:s>=u.outerWidth()-i.outerWidth()&&(s=u.outerWidth()-i.outerWidth()),e<0?e=0:e>=u.outerHeight()-i.outerHeight()&&(e=u.outerHeight()-i.outerHeight()),i.css({left:s,top:e}),p.css({"background-position":"-"+s*a+"px -"+e*a+"px"})})},function(){i.css({display:"none"}),p.css({display:"none"})});var t=decodeURIComponent(location.search.substring(1).split("=")[1]),h=$(".goods-name h1"),v=$(".goods-price span"),m=$(".services a"),f=$(".inventory span"),b=$("a.prev"),k=$("a.next");$.get("../php/detail.php?sid="+t,function(t){var s=JSON.parse(t);h.html(s.goods_name),u.attr("src",s.goods_img),p.css({background:"url("+s.goods_img+")no-repeat","background-size":"720px 720px","background-position":"0px 0px"}),v.html(s.goods_price),m.html(s.goods_state),f.html(s.goods_number);var e=(s.goods_img+","+s.piclistimg).split(",");5<e.length&&(b.css({visibility:"visible"}),k.css({visibility:"visible"}));var a="<ul class=wrap>",o=!0,i=!1,l=void 0;try{for(var n,r=e[Symbol.iterator]();!(o=(n=r.next()).done);o=!0){a+='\n                <li>\n                <img src="'+n.value+'">\n                </li>\n            '}}catch(t){i=!0,l=t}finally{try{!o&&r.return&&r.return()}finally{if(i)throw l}}a+="</ul>",x.html(a);var c=$("ul.wrap"),d=$("ul.wrap li").width()+5;c.css({position:"relative"}),c.width(d*e.length);var g=!0;b.on("click",function(){parseInt(c.css("left"))<0&&g&&(g=!1,c.animate({left:parseInt(c.css("left"))+d},function(){g=!0}))}),k.on("click",function(){0<c.width()-(-parseInt(c.css("left"))+x.width()+5)&&g&&(g=!1,c.animate({left:parseInt(c.css("left"))-d},function(){g=!0}))}),$(".goods-smallpic li:first-child").addClass("active")});var x=$(".goods-smallpic");x.on("click","li",function(){var t=$(this).children().attr("src");$(this).addClass("active").siblings().removeClass("active"),u.attr("src",t),p.css({"background-image":"url("+t+")"})})}(),function(a){a(".addbtn");var o=[],i=[],l=a("#count"),t=a(".num .add"),s=a(".num .reduce"),e=a(".inventory span"),n=void 0;l.on("change",function(){""!==e.text()&&(1==l.val()?s.addClass("disable"):s.removeClass("disable"),a(this).val()>=~~e.text()?(a(this).val(e.text()),t.addClass("disable")):t.removeClass("disable"))}),s.on("click",function(){console.log(e.text()),""!==e.text()&&(1==l.val()?s.addClass("disable"):s.removeClass("disable"),l.val()<=1?l.val(1):l.val(l.val()-1),~~l.val()<e.text()&&t.removeClass("disable"))}),t.on("click",function(){""!==e.text()&&(~~l.val()<e.text()?l.val(1+~~l.val()):(l.val(e.text()),t.addClass("disable")),1!==l.val()&&s.removeClass("disable"))}),a(".addbtn").on("click",function(){var t,s,e;a.cookie("username")?(t=location.search.substring(1).split("=")[1],s=a.inArray(t,o),n=a.cookie("username"),i=localStorage.getItem(n+"goodsid")&&localStorage.getItem(n+"goodsnum")?(o=localStorage.getItem(n+"goodsid").split(","),localStorage.getItem(n+"goodsnum").split(",")):(o=[],[]),-1!==a.inArray(t,o)?(e=parseInt(i[s])+parseInt(l.val()),i[s]=e):(o.push(t),localStorage.setItem(n+"goodsid",o),i.push(l.val())),localStorage.setItem(n+"goodsnum",i),a(".mycart .count").html(localStorage.getItem(n+"goodsid").split(",").length),alert("加入成功")):alert("请先登录用户")})}(jQuery);